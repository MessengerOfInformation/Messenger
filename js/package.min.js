((function(){if(!this.require){var a={},b={},c=function(f,g){var h=b[f],i=d(g,f),j;if(h)return h;if(!(j=a[i]||a[i=d(i,"./index")]))throw"module '"+f+"' not found";h={id:f,exports:{}};try{return b[f]=h.exports,j(h.exports,function(a){return c(a,e(i))},h),b[f]=h.exports}catch(k){throw delete b[f],k}},d=function(a,b){var c=[],d,e;/^\.\.?(\/|$)/.test(b)?d=[a,b].join("/").split("/"):d=b.split("/");for(var f=0,g=d.length;f<g;f++)e=d[f],e==".."?c.pop():e!="."&&e!=""&&c.push(e);return c.join("/")},e=function(a){return a.split("/").slice(0,-1).join("/")};this.require=function(a){return c(a,"")},this.require.define=function(b){for(var c in b)a[c]=b[c]}}return this.require.define})).call(this)({anim:function(a,b,c){((function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b=Object.prototype.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};$(function(){var b,d,e,f;return b=function(){function b(b){var c;this.options=b,this.el=this.options.element,this.boundaries=this.options.boundaries||[5,5,5,5],this.el.addEventListener("webkitTransitionEnd",a(function(a){return this.options.callback!=null&&typeof this.options.callback=="function"&&this.options.callback(a,this.pos),this.options.slideCallback&&(this.options.slideCallback(a,this.pos),this.options.slideCallback=void 0),this.after(a,this.pos)},this)),c={visible:[0,0],left:[-1,0],right:[1,0],top:[0,-1],bottom:[0,1]},this.pos=c[this.options.position]}return b.prototype.init=function(){return this.before(this.pos),this.transform(pos)},b.prototype.slide=function(b,c){var d;d={set:a(function(a){var b,c,d;return c=this.boundaries[a],d=a>1?1:0,b=this.pos[d]+[-1,1,-1,1][a],Math.abs(b)<=c?(this.pos[d]=b,!0):!1},this),left:function(){return this.set(0)},right:function(){return this.set(1)},up:function(){return this.set(2)},down:function(){return this.set(3)}},typeof c=="function"&&(this.options.slideCallback=c);if(d[b]())return this.before(this.pos),setTimeout(a(function(){return this.transform(this.pos,0)},this))},b.prototype.convertXYZ=function(a){var b;return b=a.map(function(a){return a*100}),b.push(0),b},b.prototype.transform=function(a){return a=this.convertXYZ(a),this.el.style.webkitTransform="translate3d("+a.join("%,")+")"},b.prototype.before=function(a){var b;return b=a.every(function(a){return a===0}),b?this.visible=!0:this.visible=!1},b.prototype.after=function(a,b){return null},b}(),window.pageAntimator=new b({element:$(".pages_wrapper")[0],position:"visible",boundaries:[1,0,0,0]}),$(".back").bind("fastTap",function(){var a;return pageAntimator.slide("right",function(){return $(".back").hide(),$("#messages_container").hide()}),a=$(".list").find(".active"),setTimeout(function(){return a.removeClass("active")},400)}),f=function(){function a(){a.__super__.constructor.apply(this,arguments)}return c(a,b),a.prototype.before=function(b){a.__super__.before.call(this,b);if(this.options.toggle&&this.visible)return this.el.style.display=""},a.prototype.after=function(a,b){this.options.toggle&&!this.visible&&(this.el.style.display="none");if(b[1]>=100)return this.el.style.webkitTransitionTimingFunction="cubic-bezier(.45,.7,.7,1)";if(b[1]===0)return this.el.style.webkitTransitionTimingFunction="cubic-bezier(.3,0,.7,.45)"},a}(),window.slideUpAntimator=new f({element:$(".slide_up")[0],position:"bottom",toggle:!0,boundaries:[0,0,0,1]}),d=function(b){return this.el=$(b),this.pulling=!1,this.canTrigger=!0,this.el.bind("touchmove",a(function(a){var b;b=this.el[0].scrollTop;if(b<0)return this.move(b)},this)).bind("touchend",a(function(b){if(this.pulling){this.el.trigger("stopPull"),this.pulling=!1;if(this.canTrigger)return this.el.trigger("triggerPull"),this.canTrigger=!1,setTimeout(a(function(){return this.canTrigger=!0},this),4e3)}},this)),this.threshold=-40,this.move=function(a){a<this.threshold&&this.pulling===!1&&(this.el.trigger("startPull"),this.pulling=!0);if(a>this.threshold&&this.pulling)return this.el.trigger("stopPull"),this.pulling=!1}},new d(".list"),$(".list").bind("startPull",function(a,b){return console.log("startPull"),$("#rotator")[0].style.webkitTransform="rotate(180deg) translateZ(0)"}).bind("stopPull",function(){return console.log("stopPull"),$("#rotator")[0].style.webkitTransform="rotate(0) translateZ(0)"}).bind("triggerPull",function(){var b,c,d;return b=$(".notifs"),d=$(".header").first().height(),b[0].style.top=d+"px",console.log("triggerPull"),(c=a(function(){var a;return a=this.scrollTop,setTimeout(function(){return a>=0?b.show(0,function(){return setTimeout(function(){return b.fadeOut(300)},2500)}):c()},100)},this))()}),e=function(a,b,c){var d,e;return d={clearActive:350},c=$.extend(d,c),e=$(a),e.delegate(b,"tapInstant",function(a,b){var d,e;e=d=$(this)[0],e.classList.add("active"),console.log("tapInstant");if(c.clearActive)return setTimeout(function(){return e.classList.remove("active")},c.clearActive)}),e.delegate(b,"activeTap",function(a,b){var c,d;return d=c=$(this)[0],d.classList.add("active"),console.log("Longtap")}),e.delegate(b,"endActiveTap",function(a,b){var c,d;return d=$(this)[0],c=void 0,d.classList.remove("active"),console.log("move")})},e("#list",".row",{clearActive:!1}),e(".header","button")})})).call(this)},app:function(a,b,c){((function(){"use strict";var a;a=b("models"),$(function(){var b,c;return a.init(),ScrollFix($(".list")[0]),ScrollFix($(".messages")[0]),$(".write").bind("fastTap",function(){return slideUpAntimator.slide("up")}),$(".close").bind("fastTap",function(){return slideUpAntimator.slide("down")}),$(".header").bind("touchmove",function(a){return a.preventDefault()}),$(".footer").bind("touchmove",function(a){return a.preventDefault()}),$(".sms_input").autogrow(function(a){return console.log("callback msg",a)},{allowEnter:!1}),b=function(a){var b,c,d;return c=new Date(a),b=["jan","feb","mar","apr","may","jun","jul","aug","sep","okt","nov","dec"],d=""+c.getDate()+" "+b[c.getMonth()]+" "+c.getFullYear()+" "+c.getHours()+":"+c.getMinutes()},$(".sms_input").on("onMessage",function(a,c){var d,e;return d=b(c.time),e=c.value,$(".messages").append("<article class='message cf'><footer><time>"+d+"</time></footer><div class='content'><p>"+e+"</p></div></article>"),$(".messages").forEach(function(a){return a.scrollTop=a.scrollHeight})}),c=function(){return document.body.style.height=""+window.innerHeight+"px",window.scrollTo(0,0)},$("textarea").bind("focus",function(){return c()}),$("textarea").bind("blur",function(){return c()})})})).call(this)},input:function(a,b,c){((function(){var a=function(a,b){return function(){return a.apply(b,arguments)}};(function(b){"use strict";var c,d;return d=function(a){return"".trim?a.trim():b.trim(a)},b.fn.autogrow=function(a,d){var e;return d==null&&(d={}),typeof a=="function"?d.fn=a:d=a,e={allowEnter:!0},this.each(function(a,f){return new c(b(f),b.extend(e,d))})},c=function(){function b(b,c){this.$el=b,this.options=c,this.el=this.$el[0],this.el.style.resize="none",this.el.style.webkitTransition="height .3s",this.el.style.overflowY="hidden",this.$form=this.$el.parent("form"),this.$submit=this.$form.find("[type=submit]"),this.$el.bind("keypress",a(function(a){var b;return b=a.target.value,this.setHeight(d(b)),this.handleInput(a,b)},this)),this.$form.bind("submit",a(function(a){var b;return b=this.el.value,this.handleInput(a,b)},this)),this.maxHeight=parseInt(this.$el.css("max-height"),10),this.elHeight=0}return b.prototype.setHeight=function(a){var b,c;if(!a)return this.el.style.height="",this.elHeight=0;c=this.el.scrollHeight,b=this.el.getBoundingClientRect().height||this.$el.outerHeight(),this.heightDiff||(this.heightDiff=c-b||0),c>b&&(this.elHeight=c-this.heightDiff,this.el.style.height=this.elHeight+"px");if(this.maxHeight&&this.elHeight>this.maxHeight)return this.el.style.overflowY="visible";if(this.maxHeight&&this.el.style.overflowY==="visible")return this.el.style.overflowY="hidden"},b.prototype.handleInput=function(a,b){var c,e;if(a.keyCode===13||a.type==="submit"){a.preventDefault(),e=d(b),c=a.type==="submit"||this.options.allowEnter,e&&c&&(this.triggerOutput(b),this.el.value="",this.el.focus(),this.setHeight(!1));if(e&&c===!1)return this.el.value+="\r",this.setHeight(!0)}},b.prototype.triggerOutput=function(a){var b;return b={time:+(new Date),value:a},this.$el.trigger("onMessage",b),this.options.fn&&this.options.fn(b),b},b}()})(this.Zepto||this.jQuery)})).call(this)},models:function(a,b,c){((function(){"use strict";var c,d,e,f,g,h=function(a,b){return function(){return a.apply(b,arguments)}},i=Object.prototype.hasOwnProperty,j=function(a,b){function d(){this.constructor=a}for(var c in b)i.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};g=b("views"),e=function(){return APP.instances.list=new d.list,APP.instances.messages=new d.messages,APP.instances.messages.bind("inserted",h(function(){var a;return console.log("Inserted messages"),a=document.getElementById("messages"),a.scrollTop=a.scrollHeight,pageAntimator.slide("left",function(){return $(".back").show()})},this))},a.init=e,f={},d={},c=function(){function a(){a.__super__.constructor.apply(this,arguments)}return j(a,Backbone.Collection),a.prototype.initialize=function(a,b){var c;return c=document.getElementById(this.el),this.$el=$("#"+this.el),this.bind("reset",function(a,b){var d,e,f,g,h;d=document.createDocumentFragment(),h=a.models;for(f=0,g=h.length;f<g;f++)e=h[f],d.appendChild(this.render(e));return c.appendChild(d)}),this.bind("add",function(a,b){return c.appendChild(this.render(a))}),this.$el.bind("DOMSubtreeModified",h(function(a){return this.trigger("inserted")},this))},a.prototype.render=function(a){return(new g[this.view]({model:a,collection:this})).el},a}(),f.row=function(){function a(){a.__super__.constructor.apply(this,arguments)}return j(a,Backbone.Model),a.prototype.convertTime=function(a){var b,c,d;return d=new Date(a),c=function(a){return(a<10?"0":"")+a},b=""+d.getFullYear()+"-"+c(d.getMonth()+1)+"-"+c(d.getDate())},a.prototype.initialize=function(){var a;return a=this.get("time"),this.set({time:this.convertTime(a)})},a.prototype.open=function(){return $("#messages_container").show(),APP.instances.messages.models.length?APP.instances.messages.reset().fetch():APP.instances.messages.fetch()},a}(),d.list=function(){function a(){a.__super__.constructor.apply(this,arguments)}return j(a,c),a.prototype.view="row",a.prototype.model=f.row,a.prototype.url="data/list.json",a.prototype.el="list",a.prototype.initialize=function(b,c){return a.__super__.initialize.call(this),this.fetch()},a.prototype.comparator=function(a){return-a.get("time")},a.prototype.parse=function(a){return a.length=30,a},a}(),f.message=function(){function a(){a.__super__.constructor.apply(this,arguments)}return j(a,Backbone.Model),a.prototype.convertSMSTime=function(a){var b,c,d;return d=new Date(a),c=["jan","feb","mar","apr","may","jun","jul","aug","sep","okt","nov","dec"],b=""+d.getDate()+" "+c[d.getMonth()]+" "+d.getFullYear()+" "+d.getHours()+":"+d.getMinutes()},a.prototype.initialize=function(){var a;return a=this.get("time"),this.set({time:this.convertSMSTime(a)})},a}(),d.messages=function(){function a(){a.__super__.constructor.apply(this,arguments)}return j(a,c),a.prototype.view="message",a.prototype.model=f.message,a.prototype.url="data/list.json",a.prototype.el="messages",a.prototype.initialize=function(b,c){return a.__super__.initialize.call(this)},a.prototype.parse=function(a){return a.length=5,a},a}()})).call(this)},templates:function(a,b,c){(function(){var a=Handlebars.template,b=Handlebars.templates=Handlebars.templates||{};b["/Users/Philip/Dropbox/OnGoing/iphone/scripts/../js/templates/list_search"]=a(function(a,b,c,d,e){c=c||a.helpers;var f="",g=this;return f}),b["/Users/Philip/Dropbox/OnGoing/iphone/scripts/../js/templates/message"]=a(function(a,b,c,d,e){c=c||a.helpers;var f="",g,h=this,i="function",j=c.helperMissing,k=void 0,l=this.escapeExpression;return f+="<footer>\n  <time>",g=c.time||b.time,typeof g===i?g=g.call(b,{hash:{}}):g===k&&(g=j.call(b,"time",{hash:{}})),f+=l(g)+'</time>\n</footer>\n\n<div class="content ',g=c.sender||b.sender,typeof g===i?g=g.call(b,{hash:{}}):g===k&&(g=j.call(b,"sender",{hash:{}})),f+=l(g)+'">\n  <p>',g=c.body||b.body,typeof g===i?g=g.call(b,{hash:{}}):g===k&&(g=j.call(b,"body",{hash:{}})),f+=l(g)+"</p>\n</div>",f}),b["/Users/Philip/Dropbox/OnGoing/iphone/scripts/../js/templates/message_footer"]=a(function(a,b,c,d,e){c=c||a.helpers;var f=this;return'<form class="footer" id="slideform">\n  <button tabindex="-1" class="icon camera">C</button>\n  <textarea placeholder="Message" type="text" tabindex="-1" class="sms_input search_style"></textarea>\n  <button tabindex="-1" class="green" type="submit">Send</button>\n</form>\n'}),b["/Users/Philip/Dropbox/OnGoing/iphone/scripts/../js/templates/row"]=a(function(a,b,c,d,e){c=c||a.helpers;var f="",g,h=this,i="function",j=c.helperMissing,k=void 0,l=this.escapeExpression;return f+='<div class="box center status"></div>\n<div class="box vertical flex">\n  <header class="box">\n    <h1>',g=c.sender||b.sender,typeof g===i?g=g.call(b,{hash:{}}):g===k&&(g=j.call(b,"sender",{hash:{}})),f+=l(g)+"</h1>\n    <time>",g=c.time||b.time,typeof g===i?g=g.call(b,{hash:{}}):g===k&&(g=j.call(b,"time",{hash:{}})),f+=l(g)+"</time>\n  </header>\n  <p>",g=c.body||b.body,typeof g===i?g=g.call(b,{hash:{}}):g===k&&(g=j.call(b,"body",{hash:{}})),f+=l(g)+'</p>\n</div>\n<div class="box center arrow">\n  <span>A</span>\n  <button class="delete delete_m" style="display:none">Delete</button>\n</div>',f})})()},touch:function(a,b,c){((function(){(function(a){var b,c,d,e,f,g,h,i,j,k;return h=function(a){return"tagName"in a?a:a.parentNode},i=function(a,b,c,d){var e,f;return e=Math.abs(a-b),f=Math.abs(c-d),e>=f?a-b>0?"Left":"Right":c-d>0?"Up":"Down"},b=function(){if(j.last&&Date.now()-j.last>=c&&!j.x2&&!j.y2)return a(j.target).trigger("activeTap"),j.activeTap=!0},f=function(){if(j.last&&Date.now()-j.last>=g&&!j.x2&&!j.y2)return a(j.target).trigger("longTap")},j={},k=void 0,e=void 0,d=void 0,g=750,c=200,a(document).ready(function(){return a(document.body).bind("touchstart",function(a){var i,l;return l=Date.now(),i=l-(j.last||l),j.target=h(a.touches[0].target),k&&clearTimeout(k),e&&clearTimeout(e),j.x1=a.touches[0].pageX,j.y1=a.touches[0].pageY,i>0&&i<=250&&(j.isDoubleTap=!0),j.last=l,d=setTimeout(b,c),setTimeout(f,g)}).bind("touchmove",function(b){j.x2=b.touches[0].pageX,j.y2=b.touches[0].pageY;if(j.activeTap)return a(j.target).trigger("endActiveTap",b),j={}}).bind("touchend",function(b){if(!j.x2||!j.y2)a(j.target).trigger("tapInstant",b),clearTimeout(d);if(j.isDoubleTap)return a(j.target).trigger("doubleTap"),j={};if(j.x2>0||j.y2>0)return(Math.abs(j.x1-j.x2)>30||Math.abs(j.y1-j.y2)>30)&&a(j.target).trigger("swipe")&&a(j.target).trigger("swipe"+i(j.x1,j.x2,j.y1,j.y2)),j.x1=j.x2=j.y1=j.y2=j.last=0;if("last"in j)return k=setTimeout(function(){return k=null,a(j.target).trigger("tap"),j={}},250),e=setTimeout(function(){return e=null,a(j.target).trigger("fastTap")},100)}).bind("touchcancel",function(){return j={}})}),["swipe","swipeLeft","swipeRight","swipeUp","swipeDown","doubleTap","tap","longTap"].forEach(function(b){return a.fn[b]=function(a){return this.bind(b,a)}})})(this.Zepto)})).call(this)},views:function(a,b,c){((function(){"use strict";var b,c,d,e,f=Object.prototype.hasOwnProperty,g=function(a,b){function d(){this.constructor=a}for(var c in b)f.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},h=function(a,b){return function(){return a.apply(b,arguments)}};d=b="templates",c={header:Handlebars.templates.header,message_footer:Handlebars.templates.message_footer,message:Handlebars.templates.message,row:Handlebars.templates.row},e=function(){function a(){a.__super__.constructor.apply(this,arguments)}return g(a,Backbone.View),a.prototype.initialize=function(){return this.model.bind("change",this.render,this),this.model.bind("destroy",this.remove,this),this.model.bind("error",h(function(a,b,c){if(this.error)return this.error(a,b,c)},this)),this.render()},a.prototype.render=function(){return this.el.innerHTML=this.template(this.model.toJSON()),this.$el=$(this.el),this},a.prototype.remove=function(){return $(this.el).remove()},a.prototype.clear=function(){return this.model.destroy()},a}(),views.header=function(){function a(){a.__super__.constructor.apply(this,arguments)}return g(a,e),a.prototype.tagName="header",a.prototype.className="app header",a.prototype.template=c.header,a.prototype.render=function(){},a}(),views.message_footer=function(){function a(){a.__super__.constructor.apply(this,arguments)}return g(a,e),a.prototype.tagName="footer",a.prototype.template=c.header,a.prototype.render=function(){},a}(),views.row=function(){function a(){a.__super__.constructor.apply(this,arguments)}return g(a,e),a.prototype.tagName="article",a.prototype.className="row",a.prototype.template=c.row,a.prototype.render=function(){return a.__super__.render.call(this),this.deleteButton=$(this.el).find(".delete_m")[0],this.$list=$(".list")},a.prototype.events={"tapInstant .delete .arrow":"deleteRow",swipeLeft:"deleteState",swipeRight:"deleteState",tapInstant:"open"},a.prototype.open=function(){return this.model.open()},a.prototype.deleteState=function(){var a;return this.deleting?(this.deleting=!1,this.$list.unbind("touchstart touchend"),$(this.deleteButton).anim({translate3d:"100%, 0 ,0"},".2","ease-out",h(function(){return this.$el.removeClass("delete")},this))):(this.deleting=!0,this.$el.addClass("delete"),$(this.deleteButton).anim({translate3d:"0, 0, 0"},".2","ease-out",null),a=$(this.el).find(".arrow")[0],this.$list.bind("touchstart",h(function(b){if(b.target!==a&&b.target!==this.deleteButton)return b.stopImmediatePropagation()},this)).bind("touchend",h(function(b){if(b.target!==a&&b.target!==this.deleteButton)return b.stopImmediatePropagation(),this.deleteState()},this)))},a.prototype.deleteRow=function(a){return a.stopImmediatePropagation(),this.$el.fadeOut(),this.$el.removeClass("delete")},a}(),views.message=function(){function a(){a.__super__.constructor.apply(this,arguments)}return g(a,e),a.prototype.tagName="article",a.prototype.className="message",a.prototype.template=c.message,a.prototype.render=function(){return a.__super__.render.call(this)},a}(),a.views=views})).call(this)}})